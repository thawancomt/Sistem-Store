{% extends 'base.html' %}

{% block content %}



{% block title %}
    <title>
        {{context.title}}
    </title>
{% endblock title %}

<h1 class="m-4 title-primary"> Stock reference: {{date}}
  {% if context.stocks_data_for_info_table[-1].date | string == date | string %}
  (Latest)
  {%endif%}
</h1>



<table class="table-auto border-collapse border border-slate-500">
  <thead class="">
    <td>Date</td>
    <td>Articles counted</td>
  </thead>
  <tbody class="">
    {% for row in context.stocks_data_for_info_table %}
        <tr class="">
          <td>
            <a href="{{url_for('stock.index', date=row.date)}}">{{row.date}}</a>
          </td>
          <td>
            {{row.count}}
          </td>
        </tr>      
    {% endfor %}
  </tbody>
</table>



<span class="m-4 sub-title-primary">You can change bellow the refereced stock</span>


<form action="{{url_for('stock.index')}}" class="m-4">
  <select name="date" id="" class=" form-control-1">
    {% for date_ in context.dates %}

      {% if date_.date | string == date | string  %}
          <option value="{{date_.date}}" selected>{{date_.date}}</option>
      {% else %}
          <option value="{{date_.date}}">{{date_.date}}</option>
      {% endif %}

    {% endfor %}

    </select>
    <button type="submit" class="btn-primary">Change stock reference</button>
</form>


  

  

<form action="{{url_for('stock.create')}}" method="post" id="update" class="m-4">
    
    {% for article in context.articles %}
        <label for="{{article.id}}" class="sub-title-primary">
            {{
                article.name
            }}
        </label>
        <div class="grid grid-cols-3">
          <input type="number" name="{{article.id}}" id="" value="0" max="20" class="form-control-1 col-span-2">
          <input type="number" name="{{article.id}}_total" id="" value="{{context.stock[article.id]}}"  class="form-control-1 col-span-1" disabled>
        </div>
    {% endfor %}
    <input type="datetime-local" name="date" id="" class="form-control-1" value="{{date}}" required>
    <input type="submit" value="submit" class="btn-primary" >
        

</form>

<div>
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{context.date_labels | safe}},
      datasets: {{context.data_for_chart | safe}}},
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
<script>
    let form = document.querySelector('#update');
    form.addEventListener('submit', function (eventw) {
        var t = confirm('Are you sure?');

        if (!t) {
          eventw.preventDefault()
        }
    }
    )

    /* Add a cancel if update_confirm was clicked cancel

    

    

</script>

{% endblock %}