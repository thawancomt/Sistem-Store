{% extends "base.html" %}

{% block script %}

<script src="/static/script.js"></script>
 
{% endblock script %}

{% block title %}
    <title>Homepage</title>
{% endblock %}

{% block store_title %}
    <div>
        <h1 class="title-primary text-center">
            Gest√£o {{context.store_name | title }}
        </h1>
        
    </div>
{% endblock %}

{% block user_title %}
    
{% endblock %}

{% block content  %}

<script src="../static/script.js"></script>

    {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}

                <div class="w-full flex justify-center">
                    <div class="w-5/6 h-48 border border-emerald-500 m-4">
                        <h1 class="m-4 text-white"> {{ message }}</h1>
                    </div>
                    
                </div>
                    
                {% endfor %}
            {% endif  %}
    {% endwith %}

    <div class="w-full flex justify-center">
        <div class="container-primary">
            <div class="m-4">

                <h1 class="title-primary">
                    Manager Section
                </h1>
                <p class="sub-title-primary">Here are the functions that just the managers can see</p>
                <div class="grid grid-cols-4 *:col-span-1">
                    <form action="{{url_for('stock.index')}}">
                        <button type="submit" class="btn-primary">Stock</button>
                    </form>
                    <form action="{{url_for('production.home')}}">
                        <button type="submit" class="btn-primary">Daily Production</button>
                    </form>
                    <form action="{{url_for('daily_tasks.index')}}">
                        <button type="submit" class="btn-primary">Daily tasks</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% if current_user.level <= 1 %}
     
    <div class="w-full flex justify-center">
        {% if not context['level'] == 'admin' %}
            <div class="container-primary">
                <div class="m-4">
                    <h1 class="title-primary text-yellow-400"> Adiministrator Section*</h1>
                    <p class="information-primary">This section is desnatited to the store managers, here you can acess users, stock and more</p>
                </div>
                <div class="ml-4 space-x-4  ">
                    
                    <a href="{{ url_for('users.home')}}" class="btn-primary">
                        Access Users
                    </a>

                    <a href="{{url_for('articles.view')}}" class="btn-primary">
                        Articles
                    </a>
                    <a href="{{url_for('store.home')}}" class="btn-primary">Stores</a>

                    
                </div>
            </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Tasks Card -->
    <div class="w-full flex justify-center">
        <div class="container-primary">
            <div class="m-4">
                <h1 class="title-primary">Tasks to do</h1>
                <p class="information-primary">You can add some task to the store</p>

                <div class="space-y-4 mt-4">
                    {% if context.tasks %}
                        {% for task in context.tasks %}
                            <div class="md:grid md:grid-cols-5 md:w-full md:justify-between md:text-left md:p-2 border p-1 text-center ">
                                    <div class="md:col-span-3 md:spa">
                                        
                                        <h4 class="title-primary"> {{ task.name }}</h4>
                                        <h4 class="sub-title-primary">{{task.description}}</h4>
                                        {% if task.status %}
                                            <p class=" dark:text-white  text-xs information-primary"> Concluded by: {{ task.finisher.username }} <br> at {{task.finished_at}}</p>
                                        {% else %}
                                            <p class=" dark:text-white  text-xs information-primary"> Created by: {{ task.creator.username }} <br> at {{task.created_at}}</p>
                                        {% endif %}
                                        
                                    </div>
                                    {% if not task.status %}
                                        <form action="{{ url_for('tasks.finish') }}" method="POST" class=" md:col-span-1 md:mr-2">
                                            <input type="text" name="task_id" value="{{task.id}}" hidden>
                                            <button type="submit" class="btn-primary ">Finish</button>
                                        </form>
                                    {% endif %}

                                    <form action="{{ url_for('tasks.delete') }}" method="POST"  class="md:col-span-1 {% if task.status %} md:col-span-2 {% endif %}">
                                        <input type="text" name="task_id" value="{{task.id}}" hidden>
                                        <button type="submit" class="btn-primary" id="delete_task{{task.id}}">Delete</button>
                                    </form>
                            </div>
                        {% endfor %}
                    {% else  %}
                        <h1 class="sub-title-primary line-through">Empty to do list</h1>
                    {% endif %}
                    
                    <h1 class="title-primary text-xl">Concluded tasks</h1>
                    
                </div>
                

                <form action="{{ url_for('tasks.create') }}" method="POST" class="mt-4">
                    <label for="task_name" class="sub-title-primary">Add some task</label>
                    <input type="text" name="task_name" class="form-control-1">

                    <label for="task_to_send" class="sub-title-primary">description</label>
                    <input type="text" name="task_description" class="form-control-1">
                    <button type="submit" class="btn-primary"> Create task </button>
                </form>
                    
            </div>
            
        </div>
    </div>  
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>   
{% endblock %}
